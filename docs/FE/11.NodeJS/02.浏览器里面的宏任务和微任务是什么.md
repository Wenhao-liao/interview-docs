# 浏览器里的宏任务和微任务是什么

宏任务：setTimeout和setInterval

微任务：promise.then/catch/finally



代码执行的优先级：

同步 > 异步

微任务 > 宏任务


具体流程：

* 执行栈选择最先进入队列的宏任务（一般都是script），执行其同步代码直至结束；
* 检查是否存在微任务，有则会执行至微任务队列为空；
* 执行宏任务中的异步代码（setTimeout等回调）
* 执行过程中如果遇到微任务，就将它添加到微任务的任务队列中
* 宏任务执行完毕后，立即执行当前微任务队列中的所有微任务（依次执行）
* 开始下一个宏任务（从事件队列中获取）

其中需要注意的是后面3个流程，即中途插入微任务的情况
这个时候由于上面优先级的原因，本次宏任务执行完了，会需要清空微任务队列，然后再继续执行下一个宏任务



另外，在node的环境中，会新增2个微任务的API  -- `process.nextTick，queueMicrotask`

并且在微任务中，`process.nextTick`的优先级最高，意味着，如果微任务队列里面有 `process.nextTick`，他永远在队头
